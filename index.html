<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Alt Text Updater</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://rsms.me/inter/inter.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <meta charset="utf-8" />
  <title>Alt Text Updater</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script> <!-- add this -->
  <link href="https://rsms.me/inter/inter.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

</head>
<body class="min-h-screen bg-neutral-950 text-neutral-100 antialiased font-sans selection:bg-neutral-800 selection:text-neutral-50" style="font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial, Apple Color Emoji, Segoe UI Emoji;">

  <!-- App Wrapper -->
  <div class="flex min-h-screen">

    <!-- Sidebar -->
    <aside class="hidden lg:flex w-64 flex-col border-r border-neutral-900 bg-neutral-950/60 backdrop-blur supports-[backdrop-filter]:bg-neutral-950/60">
      <div class="flex items-center gap-2 px-5 h-16 border-b border-neutral-900">
        <div class="h-7 w-7 grid place-items-center rounded-md bg-neutral-900 text-neutral-100 font-semibold tracking-tight">ATU</div>
        <div class="text-neutral-200 text-lg font-semibold tracking-tight">Alt Text Updater</div>
      </div>
      <nav class="flex-1 p-3">
        <ul class="space-y-1.5">
          <li>
            <a class="group flex items-center gap-3 px-3 py-2 rounded-md text-neutral-300 hover:text-white hover:bg-neutral-900/70 ring-1 ring-transparent hover:ring-neutral-800 transition-colors" href="#" data-nav="dashboard">
              <i data-lucide="layout-dashboard" class="w-[18px] h-[18px]"></i>
              <span class="text-sm">Dashboard</span>
            </a>
          </li>
          <li>
            <a class="group flex items-center gap-3 px-3 py-2 rounded-md text-neutral-300 hover:text-white hover:bg-neutral-900/70 ring-1 ring-transparent hover:ring-neutral-800 transition-colors" href="#" data-nav="csv">
              <i data-lucide="file-up" class="w-[18px] h-[18px]"></i>
              <span class="text-sm">CSV</span>
            </a>
          </li>
          <li>
            <a class="group flex items-center gap-3 px-3 py-2 rounded-md text-neutral-300 hover:text-white hover:bg-neutral-900/70 ring-1 ring-transparent hover:ring-neutral-800 transition-colors" href="#" data-nav="json">
              <i data-lucide="folder-cog" class="w-[18px] h-[18px]"></i>
              <span class="text-sm">jsonFiles</span>
            </a>
          </li>
          <li>
            <a class="group flex items-center gap-3 px-3 py-2 rounded-md text-neutral-300 hover:text-white hover:bg-neutral-900/70 ring-1 ring-transparent hover:ring-neutral-800 transition-colors" href="#" data-nav="run">
              <i data-lucide="play-circle" class="w-[18px] h-[18px]"></i>
              <span class="text-sm">Run Preview</span>
            </a>
          </li>
          <li>
            <a class="group flex items-center gap-3 px-3 py-2 rounded-md text-neutral-300 hover:text-white hover:bg-neutral-900/70 ring-1 ring-transparent hover:ring-neutral-800 transition-colors" href="#" data-nav="reports">
              <i data-lucide="file-chart-column" class="w-[18px] h-[18px]"></i>
              <span class="text-sm">Reports</span>
            </a>
          </li>
          <li>
            <a class="group flex items-center gap-3 px-3 py-2 rounded-md text-neutral-300 hover:text-white hover:bg-neutral-900/70 ring-1 ring-transparent hover:ring-neutral-800 transition-colors" href="#" data-nav="settings">
              <i data-lucide="settings" class="w-[18px] h-[18px]"></i>
              <span class="text-sm">Settings</span>
            </a>
          </li>
        </ul>
      </nav>
      <div class="px-4 py-4 border-t border-neutral-900">
        <div class="text-xs text-neutral-500">v1.0 • Client-side preview</div>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1">
      <!-- Top Bar -->
      <header class="sticky top-0 z-20 border-b border-neutral-900 bg-neutral-950/70 backdrop-blur supports-[backdrop-filter]:bg-neutral-950/60">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <button class="lg:hidden inline-flex items-center justify-center p-2 rounded-md text-neutral-300 hover:text-white hover:bg-neutral-900 ring-1 ring-transparent hover:ring-neutral-800" id="mobileMenu">
              <i data-lucide="menu" class="w-5 h-5"></i>
            </button>
            <h1 class="text-xl sm:text-2xl font-semibold tracking-tight text-neutral-100">Alt Text Updater</h1>
            <span class="hidden sm:inline text-xs px-2 py-1 rounded-md border border-neutral-800 text-neutral-400">Preview only • No files are modified</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="btnRunPreview" class="inline-flex items-center gap-2 px-3.5 py-2 rounded-md bg-neutral-100 text-neutral-900 hover:bg-white ring-1 ring-neutral-200/20 hover:ring-neutral-200/40 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              <i data-lucide="play" class="w-[18px] h-[18px]"></i>
              <span class="text-sm font-medium">Run Preview</span>
            </button>
            <button id="btnDownload" class="inline-flex items-center gap-2 px-3.5 py-2 rounded-md bg-neutral-900 text-neutral-100 hover:bg-neutral-800 ring-1 ring-neutral-800 hover:ring-neutral-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
              <i data-lucide="download" class="w-[18px] h-[18px]"></i>
              <span class="text-sm font-medium">Download Reports</span>
            </button>
          </div>
        </div>
      </header>

      <!-- Content -->
      <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        <!-- Quick Actions -->
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
          <!-- CSV -->
          <div class="col-span-1 rounded-lg border border-neutral-900 bg-neutral-950">
            <div class="p-4 flex items-center justify-between border-b border-neutral-900">
              <div class="flex items-center gap-2">
                <i data-lucide="file-up" class="w-[18px] h-[18px] text-neutral-300"></i>
                <h2 class="text-base font-semibold tracking-tight">CSV</h2>
              </div>
              <span id="csvStatus" class="text-xs text-neutral-400">No file</span>
            </div>
            <div class="p-4">
              <label for="csvInput" class="block">
                <div id="csvDrop" class="relative group rounded-md border border-dashed border-neutral-800 hover:border-neutral-700 bg-neutral-950/60 hover:bg-neutral-900/40 transition-colors p-5 cursor-pointer">
                  <div class="flex items-center gap-3">
                    <div class="h-10 w-10 rounded-md grid place-items-center bg-neutral-900 ring-1 ring-neutral-800">
                      <i data-lucide="upload" class="w-5 h-5 text-neutral-300"></i>
                    </div>
                    <div>
                      <div class="text-sm text-neutral-200">Drop alt-text-output.csv here</div>
                      <div class="text-xs text-neutral-500">or click to choose</div>
                    </div>
                  </div>
                  <input id="csvInput" type="file" accept=".csv,text/csv" class="absolute inset-0 opacity-0 cursor-pointer" />
                </div>
              </label>

              <!-- CSV Summary -->
              <div id="csvSummary" class="mt-4 grid grid-cols-3 gap-3 text-center">
                <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                  <div class="text-xs text-neutral-400">Rows</div>
                  <div id="csvRows" class="text-lg font-semibold tracking-tight">0</div>
                </div>
                <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                  <div class="text-xs text-neutral-400">Mode</div>
                  <div id="csvMode" class="text-lg font-semibold tracking-tight">—</div>
                </div>
                <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                  <div class="text-xs text-neutral-400">Alts</div>
                  <div id="csvAlts" class="text-lg font-semibold tracking-tight">0</div>
                </div>
              </div>

              <!-- Sample preview -->
              <div id="csvPreviewWrap" class="mt-4 hidden">
                <div class="text-xs text-neutral-400 mb-2">Sample rows</div>
                <div id="csvPreview" class="rounded-md border border-neutral-900 bg-neutral-950 divide-y divide-neutral-900 max-h-40 overflow-auto"></div>
              </div>
            </div>
          </div>

          <!-- jsonFiles -->
          <div class="col-span-1 rounded-lg border border-neutral-900 bg-neutral-950">
            <div class="p-4 flex items-center justify-between border-b border-neutral-900">
              <div class="flex items-center gap-2">
                <i data-lucide="folder-cog" class="w-[18px] h-[18px] text-neutral-300"></i>
                <h2 class="text-base font-semibold tracking-tight">jsonFiles</h2>
              </div>
              <span id="jsonStatus" class="text-xs text-neutral-400">No folder</span>
            </div>
            <div class="p-4 space-y-4">
              <div>
                <label class="inline-flex">
                  <input id="jsonInput" type="file" webkitdirectory directory multiple class="hidden" />
                  <span class="inline-flex items-center gap-2 px-3.5 py-2 rounded-md bg-neutral-900 text-neutral-100 hover:bg-neutral-800 ring-1 ring-neutral-800 hover:ring-neutral-700 cursor-pointer">
                    <i data-lucide="folder-open" class="w-[18px] h-[18px]"></i>
                    <span class="text-sm font-medium">Select jsonFiles folder</span>
                  </span>
                </label>
              </div>

              <div class="grid grid-cols-3 gap-3 text-center">
                <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                  <div class="text-xs text-neutral-400">Files</div>
                  <div id="jsonFilesCount" class="text-lg font-semibold tracking-tight">0</div>
                </div>
                <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                  <div class="text-xs text-neutral-400">Scanned</div>
                  <div id="jsonScannedCount" class="text-lg font-semibold tracking-tight">0</div>
                </div>
                <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                  <div class="text-xs text-neutral-400">Updated</div>
                  <div id="jsonUpdatedCount" class="text-lg font-semibold tracking-tight">0</div>
                </div>
              </div>

              <!-- Progress -->
              <div id="progressWrap" class="hidden">
                <div class="flex items-center justify-between text-xs text-neutral-400 mb-2">
                  <span>Processing</span>
                  <span id="progressPct">0%</span>
                </div>
                <div class="h-1.5 rounded-full bg-neutral-900 overflow-hidden ring-1 ring-neutral-900">
                  <div id="progressBar" class="h-full bg-neutral-100 rounded-full transition-all" style="width: 0%;"></div>
                </div>
              </div>

            </div>
          </div>

          <!-- Toggles + Command -->
          <div class="col-span-1 rounded-lg border border-neutral-900 bg-neutral-950">
            <div class="p-4 flex items-center justify-between border-b border-neutral-900">
              <div class="flex items-center gap-2">
                <i data-lucide="terminal" class="w-[18px] h-[18px] text-neutral-300"></i>
                <h2 class="text-base font-semibold tracking-tight">Run Settings</h2>
              </div>
            </div>
            <div class="p-4 space-y-4">
              <!-- Toggles -->
              <div class="grid grid-cols-3 gap-3">
                <label class="flex items-center justify-between p-3 rounded-md border border-neutral-900 hover:border-neutral-800 bg-neutral-950/50 cursor-pointer">
                  <div class="text-xs text-neutral-300">Dry run</div>
                  <input id="toggleDryRun" type="checkbox" class="peer hidden" checked />
                  <div class="w-10 h-6 rounded-full bg-neutral-800 relative transition-colors peer-checked:bg-neutral-100">
                    <div class="absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-neutral-100 peer-checked:bg-neutral-900 translate-x-0 peer-checked:translate-x-4 transition-transform"></div>
                  </div>
                </label>
                <label class="flex items-center justify-between p-3 rounded-md border border-neutral-900 hover:border-neutral-800 bg-neutral-950/50 cursor-pointer">
                  <div class="text-xs text-neutral-300">Backup</div>
                  <input id="toggleBackup" type="checkbox" class="peer hidden" />
                  <div class="w-10 h-6 rounded-full bg-neutral-800 relative transition-colors peer-checked:bg-neutral-100">
                    <div class="absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-neutral-100 peer-checked:bg-neutral-900 translate-x-0 peer-checked:translate-x-4 transition-transform"></div>
                  </div>
                </label>
                <label class="flex items-center justify-between p-3 rounded-md border border-neutral-900 hover:border-neutral-800 bg-neutral-950/50 cursor-pointer">
                  <div class="text-xs text-neutral-300">Rewrite src</div>
                  <input id="toggleRewrite" type="checkbox" class="peer hidden" />
                  <div class="w-10 h-6 rounded-full bg-neutral-800 relative transition-colors peer-checked:bg-neutral-100">
                    <div class="absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-neutral-100 peer-checked:bg-neutral-900 translate-x-0 peer-checked:translate-x-4 transition-transform"></div>
                  </div>
                </label>
              </div>

              <!-- Shell selector -->
              <div class="flex items-center gap-2">
                <button data-shell="bash" class="shell-btn inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-md bg-neutral-900 text-neutral-100 hover:bg-neutral-800 ring-1 ring-neutral-800 hover:ring-neutral-700 text-xs">Bash/Zsh</button>
                <button data-shell="pwsh" class="shell-btn inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-md bg-neutral-900 text-neutral-100 hover:bg-neutral-800 ring-1 ring-neutral-800 hover:ring-neutral-700 text-xs opacity-70">PowerShell</button>
                <button data-shell="cmd" class="shell-btn inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-md bg-neutral-900 text-neutral-100 hover:bg-neutral-800 ring-1 ring-neutral-800 hover:ring-neutral-700 text-xs opacity-70">CMD</button>
              </div>

              <!-- Command -->
              <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-xs text-neutral-400">Command</div>
                  <button id="btnCopyCmd" class="inline-flex items-center gap-1.5 px-2 py-1.5 rounded-md bg-neutral-900 text-neutral-100 hover:bg-neutral-800 ring-1 ring-neutral-800 hover:ring-neutral-700 text-xs">
                    <i data-lucide="clipboard-copy" class="w-[14px] h-[14px]"></i>
                    Copy
                  </button>
                </div>
                <pre id="cmdPreview" class="text-xs text-neutral-200 overflow-x-auto whitespace-pre-wrap leading-relaxed">ALT_DRY_RUN=1 python3 update_alt_text_from_csv.py</pre>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          <div class="lg:col-span-2 rounded-lg border border-neutral-900 bg-neutral-950">
            <div class="p-4 border-b border-neutral-900">
              <div class="flex items-center gap-2">
                <i data-lucide="list-checks" class="w-[18px] h-[18px] text-neutral-300"></i>
                <h3 class="text-base font-semibold tracking-tight">Preview Results</h3>
              </div>
            </div>
            <div class="p-4">
              <!-- Filters -->
              <div class="flex flex-col sm:flex-row sm:items-center gap-3 mb-4">
                <div class="flex items-center gap-2 flex-1">
                  <div class="relative flex-1">
                    <i data-lucide="search" class="w-4 h-4 text-neutral-500 absolute left-3 top-2.5 pointer-events-none"></i>
                    <input id="searchInput" class="w-full pl-9 pr-3 py-2 rounded-md bg-neutral-900 text-neutral-100 border border-neutral-800 placeholder:text-neutral-600 focus:outline-none focus:ring-2 focus:ring-neutral-700" placeholder="Filter by file or src..." />
                  </div>
                  <button id="btnClear" class="inline-flex items-center gap-1.5 px-2.5 py-2 rounded-md bg-neutral-900 text-neutral-100 hover:bg-neutral-800 ring-1 ring-neutral-800 hover:ring-neutral-700 text-xs">
                    <i data-lucide="x" class="w-[14px] h-[14px]"></i>
                    Clear
                  </button>
                </div>
                <div class="text-xs text-neutral-500">Showing <span id="rowsVisible">0</span> of <span id="rowsTotal">0</span> updates</div>
              </div>

              <!-- Table -->
              <div class="rounded-md border border-neutral-900 overflow-hidden">
                <div class="grid grid-cols-12 text-xs text-neutral-400 bg-neutral-950/70 border-b border-neutral-900">
                  <div class="col-span-4 p-2.5">JSON file</div>
                  <div class="col-span-4 p-2.5">Old src</div>
                  <div class="col-span-3 p-2.5">New alt</div>
                  <div class="col-span-1 p-2.5 text-center">Rewritten</div>
                </div>
                <div id="resultsList" class="divide-y divide-neutral-900 max-h-[420px] overflow-auto">
                  <!-- Rows injected -->
                </div>
              </div>
            </div>
          </div>

          <!-- Chart + Summary -->
          <div class="rounded-lg border border-neutral-900 bg-neutral-950">
            <div class="p-4 border-b border-neutral-900">
              <div class="flex items-center gap-2">
                <i data-lucide="pie-chart" class="w-[18px] h-[18px] text-neutral-300"></i>
                <h3 class="text-base font-semibold tracking-tight">Overview</h3>
              </div>
            </div>
            <div class="p-4 space-y-4">
              <div class="text-xs text-neutral-400">Updated vs total scanned</div>
              <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                <div>
                  <div>
                    <div>
                      <div>
                        <div class="relative">
                          <div class="h-48">
                            <div class="h-full w-full flex items-center justify-center">
                              <div class="w-full">
                                <div>
                                  <div>
                                    <div>
                                      <div class="relative">
                                        <div>
                                          <div class="relative">
                                            <div>
                                              <div>
                                                <div class="relative">
                                                  <div>
                                                    <div class="relative">
                                                      <div>
                                                        <div class="relative">
                                                          <div>
                                                            <div class="relative">
                                                              <div>
                                                                <div class="relative">
                                                                  <div>
                                                                    <div class="relative">
                                                                      <div class="relative">
                                                                        <div class="relative">
                                                                          <div class="relative">
                                                                            <div class="relative">
                                                                              <div class="relative">
                                                                                <div class="relative">
                                                                                  <div class="relative">
                                                                                    <div class="relative">
                                                                                      <div class="relative">
                                                                                        <div class="relative">
                                                                                          <div class="relative">
                                                                                            <div class="relative">
                                                                                              <div class="relative">
                                                                                                <div class="relative">
                                                                                                  <div class="relative">
                                                                                                    <div class="relative">
                                                                                                      <div class="relative">
                                                                                                        <div class="relative">
                                                                                                          <div class="relative">
                                                                                                            <div class="relative">
                                                                                                              <div class="relative">
                                                                                                                <div class="relative">
                                                                                                                  <div class="relative">
                                                                                                                    <div class="relative">
                                                                                                                      <div class="relative">
                                                                                                                        <div class="relative">
                                                                                                                          <div class="relative">
                                                                                                                            <div class="relative">
                                                                                                                              <div class="relative">
                                                                                                                                <div class="relative">
                                                                                                                                  <div>
                                                                                                                                    <div>
                                                                                                                                      <div>
                                                                                                                                        <div class="relative">
                                                                                                                                          <div class="relative">
                                                                                                                                            <div>
                                                                                                                                              <div class="relative">
                                                                                                                                                <div class="relative">
                                                                                                                                                  <div class="relative">
                                                                                                                                                    <div class="relative">
                                                                                                                                                      <div class="relative">
                                                                                                                                                        <div class="relative">
                                                                                                                                                          <div class="relative">
                                                                                                                                                            <div class="relative">
                                                                                                                                                              <div class="relative">
                                                                                                                                                                <div class="relative">
                                                                                                                                                                  <div class="relative">
                                                                                                                                                                    <div class="relative">
                                                                                                                                                                      <div class="relative">
                                                                                                                                                                        <div class="relative">
                                                                                                                                                                          <div class="relative">
                                                                                                                                                                            <div class="relative">
                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div class="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="relative">
                                                                                                                                    <div>
                                                                                                                                      <div class="relative">
                                                                                                                                        <div class="relative">
                                                                                                                                          <div class="relative">
                                                                                                                                            <div class="relative">
                                                                                                                                              <!-- Canvas MUST be nested to avoid growth bug -->
                                                                                                                                              <div class="relative">
                                                                                                                                                <canvas id="updateChart" class="w-full h-48"></canvas>
                                                                                                                                              </div>
                                                                                                                                            </div>
                                                                                                                                          </div>
                                                                                                                                        </div>
                                                                                                                                      </div>
                                                                                                                                    </div>
                                                                                                                                  </div>
                                                                                                                                </div>
                                                                                                                              </div>
                                                                                                                            </div>
                                                                                                                          </div>
                                                                                                                        </div>
                                                                                                                      </div>
                                                                                                                    </div>
                                                                                                                  </div>
                                                                                                                </div>
                                                                                                              </div>
                                                                                                            </div>
                                                                                                          </div>
                                                                                                        </div>
                                                                                                      </div>
                                                                                                    </div>
                                                                                                  </div>
                                                                                                </div>
                                                                                              </div>
                                                                                            </div>
                                                                                          </div>
                                                                                        </div>
                                                                                      </div>
                                                                                    </div>
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                            </div>
                                                                          </div>
                                                                        </div>
                                                                      </div>
                                                                    </div>
                                                                  </div>
                                                                </div>
                                                              </div>
                                                            </div>
                                                          </div>
                                                        </div>
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Summary -->
              <div class="grid grid-cols-3 gap-3 text-center">
                <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                  <div class="text-xs text-neutral-400">Total scanned</div>
                  <div id="sumScanned" class="text-lg font-semibold tracking-tight">0</div>
                </div>
                <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                  <div class="text-xs text-neutral-400">Changed files</div>
                  <div id="sumChanged" class="text-lg font-semibold tracking-tight">0</div>
                </div>
                <div class="rounded-md border border-neutral-900 bg-neutral-950 p-3">
                  <div class="text-xs text-neutral-400">Updates</div>
                  <div id="sumUpdates" class="text-lg font-semibold tracking-tight">0</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Help -->
        <div class="rounded-lg border border-neutral-900 bg-neutral-950">
          <div class="p-4 border-b border-neutral-900">
            <div class="flex items-center gap-2">
              <i data-lucide="info" class="w-[18px] h-[18px] text-neutral-300"></i>
              <h3 class="text-base font-semibold tracking-tight">How to run locally</h3>
            </div>
          </div>
          <div class="p-4 text-sm text-neutral-300 space-y-3">
            <p>Place files in the same folder:</p>
            <ul class="list-disc list-inside text-neutral-400">
              <li>update_alt_text_from_csv.py</li>
              <li>alt-text-output.csv</li>
              <li>jsonFiles/ containing your JSON documents</li>
            </ul>
            <p>Then run the generated command in your terminal. Enable “Backup” to create backup_jsonFiles before writing. Enable “Rewrite src” to replace original links with your new relative paths when a 3-column CSV provides mappings.</p>
          </div>
        </div>
      </section>

      <!-- Toasts -->
      <div id="toast" class="fixed bottom-4 right-4 pointer-events-none opacity-0 transition-opacity"></div>

      <!-- Hidden anchors for downloads -->
      <a id="downloadAnchor" class="hidden"></a>
    </main>
  </div>

  <script>
    // State
    const state = {
      csvFile: null,
      csvRows: [],
      mappings: null,
      jsonFiles: [],
      results: {
        totalFiles: 0,
        changedFiles: 0,
        updates: [], // flat list {file, old_src, alt, new_src}
        details: new Map(), // file -> [triples]
      },
      toggles: { dryRun: true, backup: false, rewrite: false },
      shell: 'bash',
      chart: null,
    };

    // Utils
    const $ = (sel) => document.querySelector(sel);
    const el = (tag, cls, txt) => {
      const n = document.createElement(tag);
      if (cls) n.className = cls;
      if (txt !== undefined) n.textContent = txt;
      return n;
    };
    function toast(msg, type = 'default') {
      const t = $('#toast');
      t.innerHTML = '';
      const wrap = el('div', 'pointer-events-auto');
      const box = el('div', 'flex items-center gap-2 px-3.5 py-2 rounded-md border text-sm');
      if (type === 'success') {
        box.className += ' border-neutral-800 bg-neutral-900 text-neutral-100';
        const ic = el('i'); ic.setAttribute('data-lucide','check-circle-2'); ic.className='w-[18px] h-[18px] text-neutral-300';
        box.appendChild(ic); box.appendChild(el('span','', msg));
      } else {
        box.className += ' border-neutral-800 bg-neutral-900 text-neutral-100';
        const ic = el('i'); ic.setAttribute('data-lucide','info'); ic.className='w-[18px] h-[18px] text-neutral-300';
        box.appendChild(ic); box.appendChild(el('span','', msg));
      }
      wrap.appendChild(box);
      t.appendChild(wrap);
      lucide.createIcons({ attrs: { 'stroke-width': 1.5 } });
      t.style.opacity = '1';
      setTimeout(() => { t.style.opacity = '0'; }, 2200);
    }

    // Path helpers
    function pathOnly(u) {
      try {
        if (!u) return '';
        if (/^[a-z]+:\/\//i.test(u)) {
          const url = new URL(u);
          return decodeURIComponent(url.pathname || '');
        }
        // strip query/hash
        return decodeURIComponent((u.split('#')[0] || '').split('?')[0] || '');
      } catch {
        return (u || '');
      }
    }
    function isImagePath(p) {
      p = (p || '').toLowerCase();
      return ['.jpg','.jpeg','.png','.gif','.webp','.svg'].some(ext => p.endsWith(ext));
    }
    function basename(p) {
      try {
        const pp = pathOnly(p);
        const segs = pp.split('/');
        return decodeURIComponent(segs[segs.length - 1] || '');
      } catch { return p || ''; }
    }
    function toSlug(s) {
      s = (s || '').toLowerCase();
      s = s.replace(/\.[a-z0-9]+$/, '');
      s = s.replace(/[0-9]/g, '');
      s = s.replace(/[^a-z]+/g, '');
      return s;
    }

    // CSV parsing (handles quotes, commas)
    function parseCSV(text) {
      const rows = [];
      let i = 0, field = '', row = [], inQuotes = false;
      while (i < text.length) {
        const c = text[i];
        if (inQuotes) {
          if (c === '"') {
            if (text[i+1] === '"') { field += '"'; i++; }
            else { inQuotes = false; }
          } else { field += c; }
        } else {
          if (c === '"') inQuotes = true;
          else if (c === ',') { row.push(field); field = ''; }
          else if (c === '\n' || c === '\r') {
            if (c === '\r' && text[i+1] === '\n') i++;
            row.push(field); rows.push(row);
            field = ''; row = [];
          } else { field += c; }
        }
        i++;
      }
      if (field.length || row.length) { row.push(field); rows.push(row); }
      // Trim trailing empty rows
      return rows.filter(r => r.some(x => (x || '').trim().length));
    }

    // Mapping loader (mirrors Python logic closely)
    function loadAltMapping(rows) {
      const byRelpath = {}, byBasename = {}, bySlug = {};
      const byOrigMap = {}; // orig_path -> [new_rel, alt]
      const altByOrigpath = {}, altByOrigbase = {};
      if (!rows || !rows.length) return { byRelpath, byBasename, bySlug, byOrigMap, altByOrigpath, altByOrigbase, mode: '—', alts: 0 };

      let startIdx = 0;
      const r0 = rows[0] || [];
      if (r0.length >=2 && (((r0[1]||'').toLowerCase().includes('alt')) || ((r0[0]||'').toLowerCase().includes('image')))) {
        startIdx = 1;
      }
      let mode = '2 cols';
      let alts = 0;

      for (let i = startIdx; i < rows.length; i++) {
        const row = rows[i];
        if (!row || row.length < 2) continue;

        if (row.length === 2 || (row.length >=3 && !(row[2]||'').trim())) {
          const raw_path = (row[0]||'').trim();
          const alt = (row[1]||'').trim();
          if (!raw_path || !alt) continue;
          alts++;

          const rel = pathOnly(/^[a-z]+:\/\//i.test(raw_path) ? new URL(raw_path).pathname : raw_path);
          if (rel && (rel.startsWith('/') || isImagePath(rel))) byRelpath[rel] = alt;

          const b = (basename(raw_path)||'').toLowerCase();
          if (b) {
            byBasename[b] = alt;
            const sl = toSlug(b); if (sl) bySlug[sl] = alt;
          }
        } else {
          mode = '3 cols';
          const new_rel = pathOnly((row[0]||'').trim());
          const alt = (row[1]||'').trim();
          const orig_raw = (row[2]||'').trim();
          const orig_path = pathOnly(orig_raw);
          if (!alt || !orig_path) continue;
          alts++;

          altByOrigpath[orig_path] = alt;
          const ob = (basename(orig_raw)||'').toLowerCase();
          if (ob) altByOrigbase[ob] = alt;

          if (new_rel) {
            byOrigMap[orig_path] = [new_rel, alt];
            if (new_rel.startsWith('/') || isImagePath(new_rel)) byRelpath[new_rel] = alt;
          }
          const b = (new_rel ? basename(new_rel) : basename(orig_raw) || '').toLowerCase();
          if (b) {
            byBasename[b] = alt;
            const sl = toSlug(b); if (sl) bySlug[sl] = alt;
          }
        }
      }
      return { byRelpath, byBasename, bySlug, byOrigMap, altByOrigpath, altByOrigbase, mode, alts };
    }

    // Matching
    function matchAltForSrc(img_src, maps) {
      if (!img_src) return '';
      const k_rel = pathOnly(img_src);
      const k_base = (basename(img_src)||'').toLowerCase();
      const k_slug = toSlug(k_base);

      if (maps.altByOrigpath[k_rel]) return maps.altByOrigpath[k_rel];
      if (maps.altByOrigbase[k_base]) return maps.altByOrigbase[k_base];
      if (maps.byRelpath[k_rel]) return maps.byRelpath[k_rel];
      if (maps.byBasename[k_base]) return maps.byBasename[k_base];
      if (maps.bySlug[k_slug]) return maps.bySlug[k_slug];
      return '';
    }

    // Node updaters (non-destructive shapes)
    function _tiptapHasAttrsSrc(node) {
      return node && typeof node === 'object' && node.attrs && typeof node.attrs === 'object' && ('src' in node.attrs);
    }
    function setAltInNode(node, alt, force=false) {
      let changed = false;
      if (!node || typeof node !== 'object') return false;

      if (node.type === 'image') {
        if (_tiptapHasAttrsSrc(node)) {
          const attrs = Object.assign({}, node.attrs || {});
          if (attrs.alt !== alt) { attrs.alt = alt; node.attrs = attrs; changed = true; }
          return changed;
        } else if ('src' in node && (force || isImagePath(String(node.src)))) {
          if (node.alt !== alt) { node.alt = alt; changed = true; }
          return changed;
        }
      }

      if (node.image && typeof node.image === 'object' && 'src' in node.image) {
        if (node.image.alt !== alt) { node.image.alt = alt; changed = true; }
      }
      if ('imageSrc' in node) {
        if (node.imageAlt !== alt) { node.imageAlt = alt; changed = true; }
      }
      if ('src' in node && (force || isImagePath(String(node.src)))) {
        if (node.alt !== alt) { node.alt = alt; changed = true; }
      }
      return changed;
    }
    function setSrcAndAltInNode(node, new_src, alt) {
      let changed = false;
      if (!node || typeof node !== 'object') return false;

      if (node.type === 'image') {
        if (_tiptapHasAttrsSrc(node)) {
          const attrs = Object.assign({}, node.attrs || {});
          if (attrs.src !== new_src) { attrs.src = new_src; changed = true; }
          if (attrs.alt !== alt) { attrs.alt = alt; changed = true; }
          node.attrs = attrs;
 return changed;
        } else if ('src' in node) {
          if (node.src !== new_src) { node.src = new_src; changed = true; }
          if (node.alt !== alt) { node.alt = alt; changed = true; }
          return changed;
        }
      }

      if (node.image && typeof node.image === 'object' && 'src' in node.image) {
        if (node.image.src !== new_src) { node.image.src = new_src; changed = true; }
        if (node.image.alt !== alt) { node.image.alt = alt; changed = true; }
      }
      if ('imageSrc' in node) {
        if (node.imageSrc !== new_src) { node.imageSrc = new_src; changed = true; }
        if (node.imageAlt !== alt) { node.imageAlt = alt; changed = true; }
      }
      if ('src' in node) {
        if (node.src !== new_src) { node.src = new_src; changed = true; }
        if (node.alt !== alt) { node.alt = alt; changed = true; }
      }
      return changed;
    }

    function updateImageAltsInJSON(data, maps, rewrite_src, updates) {
      let changed = false;

      function walk(node) {
        let nodeChanged = false;

        if (node && typeof node === 'object' && !Array.isArray(node)) {
          let target_src = null;

          if (node.image && typeof node.image === 'object' && 'src' in node.image) {
            target_src = node.image.src;
          } else if ('imageSrc' in node) {
            target_src = node.imageSrc;
          } else if (node.type === 'image') {
            if (_tiptapHasAttrsSrc(node)) target_src = node.attrs.src;
            else if ('src' in node) target_src = node.src;
          } else if ('src' in node) {
            const candidate = node.src;
            const k_rel = pathOnly(String(candidate));
            const k_base = (basename(String(candidate))||'').toLowerCase();
            const k_slug = toSlug(k_base);
            const looks = isImagePath(String(candidate)) ||
              (k_rel in maps.byOrigMap) ||
              (k_rel in maps.altByOrigpath) || (k_base in maps.altByOrigbase) ||
              (k_base in maps.byBasename) || (k_slug in maps.bySlug);
            if (looks) target_src = candidate;
          }

          if (target_src) {
            const old_src = String(target_src);
            const k_rel = pathOnly(old_src);

            if (rewrite_src && (k_rel in maps.byOrigMap)) {
              const [new_rel, alt] = maps.byOrigMap[k_rel];
              if (setSrcAndAltInNode(node, new_rel, alt)) {
                updates.push({ file: null, old_src, alt, new_src: new_rel });
                nodeChanged = true;
              }
            } else {
              const alt = matchAltForSrc(old_src, maps);
              if (alt) {
                if (setAltInNode(node, alt, true)) {
                  updates.push({ file: null, old_src, alt, new_src: null });
                  nodeChanged = true;
                }
              }
            }
          }

          for (const key of Object.keys(node)) {
            const [nv, ch] = walk(node[key]);
            if (ch) node[key] = nv;
            nodeChanged = nodeChanged || ch;
          }
          return [node, nodeChanged];
        }

        if (Array.isArray(node)) {
          let anyChanged = false;
          const arr = node.slice();
          for (let i = 0; i < arr.length; i++) {
            const [nv, ch] = walk(arr[i]);
            if (ch) arr[i] = nv;
            anyChanged = anyChanged || ch;
          }
          return [arr, anyChanged];
        }

        return [node, false];
      }

      const [nv, ch] = walk(data);
      changed = ch;
      return [nv, changed];
    }

    // Rendering helpers
    function renderCSVPreview(rows) {
      const preview = $('#csvPreview');
      const wrap = $('#csvPreviewWrap');
      preview.innerHTML = '';
      if (!rows || !rows.length) {
        wrap.classList.add('hidden');
        return;
      }
      wrap.classList.remove('hidden');

      const head = rows[0] || [];
      const maxCols = Math.min(3, Math.max(...rows.map(r => r.length)));
      const sample = rows.slice(0, 6);
      for (const row of sample) {
        const div = el('div', 'grid gap-2 p-2.5 text-xs text-neutral-300');
        div.style.gridTemplateColumns = `repeat(${maxCols}, minmax(0, 1fr))`;
        for (let i = 0; i < maxCols; i++) {
          const cell = el('div', 'truncate');
          const val = (row[i] || '').trim();
          cell.textContent = val || '—';
          div.appendChild(cell);
        }
        preview.appendChild(div);
      }
    }

    function formatInt(n) {
      return Number(n || 0).toLocaleString();
    }

    function setButtonState() {
      const canRun = state.mappings && state.jsonFiles.length > 0;
      const runBtn = $('#btnRunPreview');
      const dlBtn = $('#btnDownload');
      runBtn.disabled = !canRun;
      dlBtn.disabled = !(state.results && state.results.updates && state.results.updates.length);
    }

    function updateCommand() {
      const parts = [];
      const isWin = state.shell === 'pwsh' || state.shell === 'cmd';

      const envs = {
        ALT_DRY_RUN: state.toggles.dryRun ? '1' : '0',
        ALT_BACKUP: state.toggles.backup ? '1' : '0',
        ALT_REWRITE_SRC: state.toggles.rewrite ? '1' : '0',
      };

      let cmd = '';
      if (state.shell === 'bash') {
        cmd = `${Object.keys(envs).map(k => `${k}=${envs[k]}`).join(' ')} python3 update_alt_text_from_csv.py`;
      } else if (state.shell === 'pwsh') {
        cmd = `${Object.keys(envs).map(k => `$env:${k}=${envs[k]};`).join(' ')} python update_alt_text_from_csv.py`;
      } else {
        cmd = `${Object.keys(envs).map(k => `set ${k}=${envs[k]}`).join(' && ')} && python update_alt_text_from_csv.py`;
      }

      $('#cmdPreview').textContent = cmd;
    }

    function clearResults() {
      state.results = {
        totalFiles: 0,
        changedFiles: 0,
        updates: [],
        details: new Map(),
      };
      $('#resultsList').innerHTML = '';
      $('#rowsTotal').textContent = '0';
      $('#rowsVisible').textContent = '0';
      $('#sumScanned').textContent = '0';
      $('#sumChanged').textContent = '0';
      $('#sumUpdates').textContent = '0';
      if (state.chart) {
        state.chart.data.datasets[0].data = [0, 1];
        state.chart.update();
      }
      setButtonState();
    }

    function renderRows(filter = '') {
      const list = $('#resultsList');
      list.innerHTML = '';

      const q = (filter || '').toLowerCase().trim();
      const rows = state.results.updates.map(u => ({
        file: u.file || '',
        old_src: u.old_src || '',
        alt: u.alt || '',
        rewritten: !!u.new_src,
      }));

      const filtered = q
        ? rows.filter(r =>
            r.file.toLowerCase().includes(q) ||
            r.old_src.toLowerCase().includes(q) ||
            r.alt.toLowerCase().includes(q)
          )
        : rows;

      $('#rowsTotal').textContent = formatInt(rows.length);
      $('#rowsVisible').textContent = formatInt(filtered.length);

      for (const r of filtered) {
        const row = el('div', 'grid grid-cols-12 text-sm hover:bg-neutral-950/60 transition-colors');
        const c1 = el('div', 'col-span-4 p-2.5 truncate text-neutral-200', r.file);
        const c2 = el('div', 'col-span-4 p-2.5 break-all text-neutral-300');
        c2.textContent = r.old_src;
        const c3 = el('div', 'col-span-3 p-2.5 text-neutral-100');
        c3.textContent = r.alt;
        const c4 = el('div', 'col-span-1 p-2.5 grid place-items-center');
        const badge = el(
          'span',
          'inline-flex items-center gap-1 text-[11px] px-2 py-1 rounded-md ring-1 ' +
            (r.rewritten ? 'bg-emerald-500/10 text-emerald-300 ring-emerald-500/20' : 'bg-neutral-900 text-neutral-300 ring-neutral-800')
        );
        const ic = el('i'); ic.setAttribute('data-lucide', r.rewritten ? 'check' : 'minus');
        ic.className = 'w-[14px] h-[14px]';
        badge.appendChild(ic);
        badge.appendChild(el('span', '', r.rewritten ? 'Yes' : 'No'));
        c4.appendChild(badge);

        row.appendChild(c1); row.appendChild(c2); row.appendChild(c3); row.appendChild(c4);
        list.appendChild(row);
      }

      lucide.createIcons({ attrs: { 'stroke-width': 1.5 } });
    }

    function renderSummary() {
      $('#sumScanned').textContent = formatInt(state.results.totalFiles);
      $('#sumChanged').textContent = formatInt(state.results.changedFiles);
      $('#sumUpdates').textContent = formatInt(state.results.updates.length);

      // Chart: changed files vs unchanged files
      const changed = state.results.changedFiles || 0;
      const total = state.results.totalFiles || 0;
      const unchanged = Math.max(total - changed, 0);
      if (!state.chart) {
        const ctx = document.getElementById('updateChart');
        if (!ctx) return;
        state.chart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['Changed files', 'Unchanged files'],
            datasets: [{
              data: [changed, Math.max(unchanged, 1)],
              backgroundColor: ['#e5e5e5', '#262626'],
              borderWidth: 0
            }]
          },
          options: {
            responsive: true,
            cutout: '65%',
            plugins: {
              legend: {
                display: true,
                labels: { color: '#a3a3a3', boxWidth: 10, boxHeight: 10, usePointStyle: true, pointStyle: 'circle' }
              },
              tooltip: {
                enabled: true,
                callbacks: {
                  label(ctx) {
                    const label = ctx.label || '';
                    const v = ctx.parsed || 0;
                    return `${label}: ${formatInt(v)}`;
                  }
                }
              }
            }
          }
        });
      } else {
        state.chart.data.datasets[0].data = [changed, Math.max(unchanged, 1)];
        state.chart.update();
      }
    }

    // Event handlers
    function handleCSV(file) {
      if (!file) return;
      state.csvFile = file;
      $('#csvStatus').textContent = file.name;

      const reader = new FileReader();
      reader.onload = () => {
        try {
          const text = String(reader.result || '');
          const rows = parseCSV(text);
          state.csvRows = rows;
          const maps = loadAltMapping(rows);
          state.mappings = maps;

          $('#csvRows').textContent = formatInt(rows.length);
          $('#csvMode').textContent = maps.mode || '—';
          $('#csvAlts').textContent = formatInt(maps.alts || 0);

          renderCSVPreview(rows);
          updateCommand();
          setButtonState();

          if (maps.mode === '3 cols' && !state.toggles.rewrite) {
            toast('Tip: Enable "Rewrite src" to apply CSV path mappings.', 'default');
          }
        } catch (e) {
          console.error(e);
          toast('Failed to parse CSV', 'default');
        }
      };
      reader.readAsText(file);
    }

    function handleJSONFolder(files) {
      const arr = Array.from(files || []).filter(f => f.name.toLowerCase().endsWith('.json'));
      state.jsonFiles = arr.sort((a, b) => (a.webkitRelativePath || a.name).localeCompare(b.webkitRelativePath || b.name));
      $('#jsonFilesCount').textContent = formatInt(state.jsonFiles.length);
      $('#jsonStatus').textContent = state.jsonFiles.length ? 'Folder selected' : 'No folder';
      setButtonState();
    }

    async function runPreview() {
      if (!state.mappings || !state.jsonFiles.length) {
        toast('Select a CSV and a jsonFiles folder first', 'default');
        return;
      }
      clearResults();
      $('#progressWrap').classList.remove('hidden');
      $('#progressBar').style.width = '0%';
      $('#progressPct').textContent = '0%';
      $('#jsonScannedCount').textContent = '0';
      $('#jsonUpdatedCount').textContent = '0';
      $('#btnRunPreview').disabled = true;

      const total = state.jsonFiles.length;
      state.results.totalFiles = total;

      for (let i = 0; i < total; i++) {
        const f = state.jsonFiles[i];
        const rel = f.webkitRelativePath || f.name;

        let text = '';
        try {
          text = await f.text();
        } catch (e) {
          console.warn('Read error', rel, e);
          continue;
        }

        let data;
        try {
          data = JSON.parse(text);
        } catch (e) {
          console.warn('JSON parse error', rel, e);
          continue;
        }

        const localUpdates = [];
        const [newData, changed] = updateImageAltsInJSON(data, state.mappings, state.toggles.rewrite, localUpdates);

        // Bind file path to each update
        for (const u of localUpdates) u.file = rel;

        if (changed && state.toggles.dryRun) {
          // In preview, we do not write files.
        }

        if (changed) state.results.changedFiles += 1;
        state.results.updates.push(...localUpdates);
        state.results.details.set(rel, localUpdates);

        $('#jsonScannedCount').textContent = formatInt(i + 1);
        $('#jsonUpdatedCount').textContent = formatInt(state.results.changedFiles);
        const pct = Math.round(((i + 1) / total) * 100);
        $('#progressBar').style.width = `${pct}%`;
        $('#progressPct').textContent = `${pct}%`;

        if ((i + 1) % 25 === 0) await new Promise(r => setTimeout(r, 0));
      }

      $('#progressWrap').classList.add('hidden');
      renderRows($('#searchInput').value);
      renderSummary();
      setButtonState();
      $('#btnRunPreview').disabled = false;

      if (!state.results.updates.length) {
        toast('No updates detected with current CSV and settings.', 'default');
      } else {
        toast('Preview completed.', 'success');
      }
    }

    function downloadReports() {
      if (!state.results || !state.results.totalFiles) {
        toast('Nothing to download yet', 'default');
        return;
      }
      const report = {
        generatedAt: new Date().toISOString(),
        toggles: state.toggles,
        shell: state.shell,
        csv: {
          name: state.csvFile ? state.csvFile.name : null,
          rows: state.csvRows.length,
          mode: state.mappings ? state.mappings.mode : '—',
          alts: state.mappings ? state.mappings.alts : 0
        },
        summary: {
          totalFiles: state.results.totalFiles,
          changedFiles: state.results.changedFiles,
          updates: state.results.updates.length
        },
        updates: state.results.updates
      };

      const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = $('#downloadAnchor');
      a.href = url;
      a.download = 'alt-text-preview-report.json';
      a.click();
      setTimeout(() => URL.revokeObjectURL(url), 1000);
      toast('Report downloaded.', 'success');
    }

    // Wire up DOM
    document.addEventListener('DOMContentLoaded', () => {
      lucide.createIcons({ attrs: { 'stroke-width': 1.5 } });

      // CSV input
      const csvInput = $('#csvInput');
      csvInput.addEventListener('change', (e) => {
        if (e.target.files && e.target.files[0]) {
          handleCSV(e.target.files[0]);
        }
      });

      // Drag & drop CSV
      const csvDrop = $('#csvDrop');
      ['dragenter', 'dragover'].forEach(ev => {
        csvDrop.addEventListener(ev, (e) => {
          e.preventDefault(); e.stopPropagation();
          csvDrop.classList.add('ring-1', 'ring-neutral-700');
        });
      });
      ['dragleave', 'drop'].forEach(ev => {
        csvDrop.addEventListener(ev, (e) => {
          e.preventDefault(); e.stopPropagation();
          csvDrop.classList.remove('ring-1', 'ring-neutral-700');
        });
      });
      csvDrop.addEventListener('drop', (e) => {
        const file = e.dataTransfer.files[0];
        if (file && /\.csv$/i.test(file.name)) {
          handleCSV(file);
        } else {
          toast('Please drop a .csv file', 'default');
        }
      });

      // json folder
      $('#jsonInput').addEventListener('change', (e) => {
        handleJSONFolder(e.target.files || []);
      });

      // Shell buttons
      document.querySelectorAll('.shell-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.shell-btn').forEach(b => b.classList.add('opacity-70'));
          btn.classList.remove('opacity-70');
          state.shell = btn.getAttribute('data-shell');
          updateCommand();
        });
      });

      // Toggles
      $('#toggleDryRun').addEventListener('change', (e) => {
        state.toggles.dryRun = e.target.checked;
        updateCommand();
      });
      $('#toggleBackup').addEventListener('change', (e) => {
        state.toggles.backup = e.target.checked;
        updateCommand();
      });
      $('#toggleRewrite').addEventListener('change', (e) => {
        state.toggles.rewrite = e.target.checked;
        if (state.toggles.rewrite && state.mappings && state.mappings.mode !== '3 cols') {
          toast('Rewrite requires a 3-column CSV (new_rel, alt, orig_path).', 'default');
        }
        updateCommand();
      });

      // Search
      const searchInput = $('#searchInput');
      searchInput.addEventListener('input', (e) => {
        renderRows(e.target.value);
      });
      $('#btnClear').addEventListener('click', () => {
        searchInput.value = '';
        renderRows('');
      });

      // Run + Download
      $('#btnRunPreview').addEventListener('click', runPreview);
      $('#btnDownload').addEventListener('click', downloadReports);

      // Copy command
      $('#btnCopyCmd').addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText($('#cmdPreview').textContent);
          toast('Command copied to clipboard.', 'success');
        } catch {
          toast('Failed to copy command', 'default');
        }
      });

      // Initial state
      updateCommand();
      setButtonState();
    });
  </script>
  <script>
    // Mobile menu basic toggle (show sidebar as overlay)
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('mobileMenu');
      const aside = document.querySelector('aside');
      let open = false;
      if (!btn || !aside) return;

      function setOpen(v) {
        open = v;
        if (open) {
          aside.classList.remove('hidden');
          aside.classList.add('fixed', 'inset-0', 'z-30', 'w-64');
          aside.style.boxShadow = '0 0 0 9999px rgba(0,0,0,.5)';
        } else {
          aside.classList.add('hidden');
          aside.classList.remove('fixed', 'inset-0', 'z-30', 'w-64');
          aside.style.boxShadow = '';
          aside.classList.add('lg:flex');
        }
      }
      btn.addEventListener('click', () => setOpen(!open));
      // Close on outside click
      aside.addEventListener('click', (e) => {
        if (e.target === aside) setOpen(false);
      });
      // Close on ESC
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') setOpen(false);
      });
    });
  </script>
</body>
</html>